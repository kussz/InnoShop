@model int

@{
    ViewData["Title"] = "Удаление населённого пункта";
}

<div id="loading" style="display: block;">Загрузка...</div>
<div id="loadedItems" style="display: none;">
    <h3>Вы уверены?</h3>
    <div>
        <h4>Населённый пункт</h4>
        <hr />
        <dl class="row">
            <dd class = "col-sm-10 text-danger" id="name">
                N/A
            </dd>
        </dl>
    
            <button id="deleteButton" class="btn btn-danger">Удалить</button> |
            <a id="cancelButton">Отмена</a>
    </div>
</div>
@section Scripts
{
    <script src="~/js/Detail.js" asp-append-version="true"></script>
        
    <script>
        async function func(item) {
            document.getElementById("name").textContent=`- ${item.name}`
            document.getElementById("cancelButton").setAttribute('href', `/Locality/Details/${item.id}`)
        }
        fetchItem(`${productHost}/Locality`, @Model, func);

        document.getElementById('deleteButton').addEventListener('click', async function () {
            await funch();
        });
    async function funch() {
    const url = window.location.href;
    const urlParts = url.split('/'); // Разделяем URL по '/'
    const id = urlParts[urlParts.length - 1]; // Предполагаем, что id — это последний элемент
    try {
        // Выполняем POST-запрос
                const response = await fetch(`${productHost}/Locality/Delete/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('jwtToken')}`
            }
        })
        if (!response.ok) {
                    if (response.status == 401)
                        window.location.href = '/Account/Unauthorized'
                    if (response.status == 403)
                        window.location.href = '/Account/Forbidden'
            throw new Error('Ошибка входа: ' + response.statusText);
        }
        window.location.href = "/Locality"
    } catch (error) {

    }
}
    </script>
}
